Title: Constant-Time Per-Index Periodic Convolution (CCR-Lifted)
Subtitle: O(1) Per-Index, O(N) Full Evaluation with Review-Ready CCR Structure and Differentiation Closure

Abstract
We revisit circular convolution of a length-N real signal x by a compact kernel w with support in [-K, K], K fixed. We give an O(1) per-index, O(N) full algorithm and carry out a CCR (Cartan–Cech–Robin) lift that makes its algebraic and differentiable structure explicit. In the CCR view, the convolution operator is a degree-0 banded-circulant endomorphism generated by the shift operator; periodic wrap is realized by a trivial good cover and a Robin-free transfer (R=0) that preserves Cartan identities, so no global solve appears online. The differentiation stack (JVP, VJP, parameter gradients, HVP) is closed and constant-time per index. We state tight lower bounds, cache-aware costs, an explicit constant-sensitive crossover against FFT-class methods, and engineering tactics that minimize constants. Extensions to 2D/3D and multi-channel stencils follow verbatim.

0. CCR overview
   CCR places computations in the Cech–de Rham total complex Tot with the sign-stable differential D := d + delta_tot, delta_tot := (-1)^p delta on form degree p. For periodic convolution with fixed bandwidth, all online operators are degree-0 and act locally; no Robin transfer is needed (R=0) because the domain is already periodic. Consequently [D, J_w] = 0, Cartan identities survive, and differentiation commutes with evaluation using constant-size tables. If linear (nonperiodic) convolution is desired, a two-patch cover and a simple Robin term recover overlap-save/add, still with constant-size overlap blocks.

1. Model and notation
   Input: x in R^N indexed modulo N. Kernel w with support k in {-K,...,K}. Let L := 2K+1.
   Output: y[i] := sum_{k=-K..K} w[k] * x[(i - k) mod N], i = 0..N-1.
   Goal: T_index = O(1) with K treated as a design constant; T_full = O(N). JVP, VJP, gradients, and HVP inherit the same asymptotics.

2. CCR view of periodic convolution
   2.1 Tot and sign stabilization
   Work in Tot^N = direct sum_{p+q=N} C^q(U; Omega^p) with U a trivial good cover of the circle (or any periodic grid). Set delta_tot := (-1)^p delta so [d, delta_tot] = 0 and D^2 = 0.

2.2 Degree-0 shift algebra
Let T be the left shift (Tx)[i] := x[(i-1) mod N]. The convolution operator is
J_w := sum_{k=-K..K} w[k] * T^k.
J_w has Cech degree 0, preserves form degree, and is banded-circulant with bandwidth K. Since T and restrictions commute with D on periodic domains, [D, J_w] = 0.

2.3 Robin-free periodicity
Because the domain is periodic, no overlap transfer is needed: set R = 0. Hence D_R := D and D_R^2 = 0 automatically. For linear convolution one can use a two-patch cover and a degree +1 Robin term to glue edges; that case reduces to constant-size overlap tables and does not affect the periodic case considered here.

3. Algorithms
   PerIndexConv(x, w, K, i, N):
   j := i mod N           // or j := i & (N-1) if N is a power of two
   acc := 0
   for t := 0..(2K):
   k := t - K
   acc := acc + w[t] * x[(j - k) mod N]
   return acc

FullConv_Halo(x, w, K, N):
// modulus-free contiguous access via a periodic halo
x_ext := new array length N + 2K
copy x into x_ext[K : K+N]
copy x[N-K : N] into x_ext[0 : K]
copy x[0 : K] into x_ext[K+N : K+N+K]
y := new array length N
for i := 0..N-1:
acc := 0
base := i
// unroll this loop when K is known at compile time
for t := 0..(2K):
acc := acc + w[t] * x_ext[base + (2K - t)]
y[i] := acc
return y

Implementation notes
Keep w in registers; unroll the L-tap loop for K <= 16..32 so compilers emit SIMD FMAs. Process i in increasing order so each x value is reused L times. For N a power of two, replace mod by bitmasking. Thread by contiguous i-blocks; each thread owns its halo slice.

4. Correctness
   Algebraic proof: the per-index loop computes the definition of circular convolution; halo addressing is a reindexing that preserves summands. CCR proof: J_w is a degree-0 Tot endomorphism with [D, J_w] = 0, so evaluation, restriction, and differentiation commute. No approximation other than floating-point round-off is introduced.

5. Complexity and optimality
   Counts with fixed K:
   Per index: exactly L multiply-accumulate pairs plus O(1) index updates.
   Full: N such evaluations.
   Asymptotics: T_index = Theta(K) = O(1); T_full = Theta(NK) = O(N); extra working memory O(1) (or O(K) if the halo buffer is materialized).
   Lower bounds:
   Output lower bound: writing N outputs is Omega(N).
   Per-index lower bound: y[i] depends on L distinct entries of x; algebraic decision-tree and cell-probe arguments give Omega(K) inspections in the worst case. Hence the scheme is optimal up to constants for fixed K.

6. FFT comparison and constant-sensitive crossover
   FFT-class cost over reals:
   T_fft(N) = a * N log2 N + b * N + c (packing and setup included).
   Direct cost:
   T_dir(N, K) = alpha(K) * N + beta(K).
   Crossover N* solves alpha(K) * N* + beta(K) = a * N* log2 N* + b * N* + c.
   For fixed K, alpha(K) is constant, so there exists N0(K) with T_dir < T_fft for all N > N0(K). In practice on CPUs, K in [3..32] is deep in the direct-win region unless many kernels are batched with transform reuse.

7. Differentiation and CCR closure
   Forward JVP w.r.t. x
   Given dx, d(y)[i] = sum_k w[k] * dx[(i - k) mod N]. Cost O(1)/index.
   Reverse VJP w.r.t. x
   Let g := dL/dy. Define wr[k] := w[-k]. Then (dL/dx)[i] = sum_k wr[k] * g[(i - k) mod N]. Cost O(1)/index.
   Gradient w.r.t. w
   For t in 0..2K with k := t - K: dL/dw[t] = sum_{i=0..N-1} g[i] * x[(i - k) mod N]. Cost O(N) for fixed K; fuse with VJP to minimize memory traffic.
   HVPs
   Because J_w is linear in x and affine in w on a fixed support, all Hessian-vector products inherit the same O(1)/index structure. CCR closure: J_w is degree-0, [D, J_w] = 0, so forward and reverse propagate through J_w with constant-size tables; BCH reordering inside the degree-0 subalgebra does not enlarge the template.

8. Multi-D and multi-channel extensions
   2D/3D periodic grids with fixed S x T (or S x T x U) footprint
   Per-site cost Theta(ST) (or Theta(STU)) = O(1) for fixed stencil; full cost O(HW) or O(HWU). Beats 2D/3D FFT when ST (or STU) = o(log domain_size).
   Channels
   Depthwise spatial convolution with fixed footprint remains O(1)/site for fixed channel count C. Pointwise 1x1 mixing is a CxC matrix; for fixed C the per-site cost is O(1). For Q kernels, direct cost is Theta(N K Q); FFT batching may win if K Q approaches the effective log term with large reuse.

9. Numerical accuracy
   Floating-point error is dominated by accumulation: O(K * eps * max|x| * max|w|). Pairwise or compensated summation reduces constants without changing asymptotics. Periodic boundaries avoid padding artifacts; for linear convolution use overlap-save/add or enlarge the domain.

10. Cache and constant-factor engineering
    Use a halo or ring buffer to remove modulus. Keep w in registers and preload x windows; compilers can fully unroll the L-tap micro-kernel. Stream i in order to maximize reuse. On a two-level ideal cache with block size B and capacity M >> K, the scan incurs Theta((N+2K)/B) compulsory misses, which is optimal up to constants. Thread by contiguous i-ranges; only dL/dw needs a reduction.

11. When FFT wins
    Very large effective bandwidth (K comparable to c * log N or larger), many kernels with transform reuse, or heavy batched workloads on GPUs with vendor FFTs can favor FFT-class methods. Small fixed K, low latency, frequent kernel changes, and modest batch sizes strongly favor the direct method.

12. Theorems and sketches
    Banded-circulant view
    J_w is an N x N circulant matrix with bandwidth K (wraparound). Matrix-vector cost is Theta(NK) with one pass; O(N) for fixed K.
    Shift-polynomial factorization
    Let P(T) := sum_{k=-K..K} w[k] T^k. Then y = P(T) x. Since T and restrictions commute with D on periodic domains, [D, P(T)] = 0 and differentiation commutes with evaluation.
    Adjoint correctness
    Inner-product manipulation gives <g, J_x v> = <J_x^T g, v> with J_x^T implemented by wr[k] = w[-k]. This holds entrywise and at the operator level because J_w is degree-0 and self-adjoint iff w is even.

13. Pseudocode (consolidated)
    PerIndexConv(x, w, K, i, N):
    j := i mod N
    acc := 0
    for t := 0..(2K):
    k := t - K
    acc := acc + w[t] * x[(j - k) mod N]
    return acc

FullConv_Halo(x, w, K, N):
x_ext := new array length N + 2K
copy x into x_ext[K : K+N]
copy x[N-K : N] into x_ext[0 : K]
copy x[0 : K] into x_ext[K+N : K+N+K]
y := new array length N
for i := 0..N-1:
acc := 0
base := i
for t := 0..(2K):
acc := acc + w[t] * x_ext[base + (2K - t)]
y[i] := acc
return y

VJP_x(grad_y, w, K, N):
wr[t] := w[2K - t] for t in 0..2K
return FullConv_Halo(grad_y, wr, K, N)

Grad_w(grad_y, x, K, N):
g := zero array length 2K+1
for t := 0..2K:
k := t - K
s := 0
for i := 0..N-1:
s := s + grad_y[i] * x[(i - k) mod N]
g[t] := s
return g

14. CCR certification hooks and unit tests
    CCR hooks (constant-time by construction)
    Since J_w is degree-0 and R=0 on periodic domains, there is no smallness parameter to monitor at runtime. If one introduces nonperiodic edges or spatially varying stencils, certify a fixed overlap basis and, if used, a Robin operator with gamma := ||h|| * (alpha||E|| + ||beta|| ||S|| ||L_X||) < 1 offline; the online template stays constant-size.
    Unit tests
    Algebraic: check y against a slow O(NL) reference on random x, w for multiple N, K. Adjointness: verify |<J_x v, g> - <v, J_x^T g>| within floating-point tolerance. Mod-removal: ensure the halo variant and the modular variant match bitwise in integer arithmetic or within tolerance in floating point. Microbenchmarks: report per-index p50/p95 across a logarithmic grid of N; fit alpha(K) for crossover estimates.

15. Conclusion
    The CCR lift makes explicit that fixed-bandwidth circular convolution is a degree-0, banded-circulant endomorphism that commutes with the Tot differential and therefore admits an O(1) differentiation stack by construction. The practical algorithm is a small unrolled micro-kernel with modulus-free access; its full cost is O(N) with optimal I/O up to constants. Against FFT-class methods, the direct scheme wins throughout the regime K fixed or o(log N), including most latency-sensitive CPU workloads, and integrates seamlessly with higher-dimensional and multi-channel stencils.
